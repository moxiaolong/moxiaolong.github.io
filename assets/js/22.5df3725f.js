(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{339:function(s,t,a){"use strict";a.r(t);var e=a(8),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("环境是GitLab私服，私有仓库，仅允许SSH拉取，自定义端口。\n")]),s._v(" "),t("p",[s._v("遇到过的错误有：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go: unrecognized "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" path "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git.dev.dra-m.com/common/test-private-module"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" parse http://git.dev.dra-m.com/common/test-private-module?go-get"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": no go-import meta tags "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("meta tag git.dev.dra-m.com:9999/common/test-private-module did not match "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" path git.dev.dra-m.com/common/test-private-module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n\nstatus "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v(":\n        fatal: unable to connect to git.dev.dra-m.com:\n        git.dev.dra-m.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".98.18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("errno")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Unknown error\n\t\t\n\n\ngo: downloading git.dev.dra-m.com/common/test-private-module.git v0.0.0-20220831074151-6d5aa689f730\ngo: git.dev.dra-m.com/common/test-private-module.git@v0.0.0-20220831074151-6d5aa689f730: parsing go.mod:\n        module declares its path as: git.dev.dra-m.com/common/test-private-module\n                but was required as: git.dev.dra-m.com/common/test-private-module.git\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h4",{attrs:{id:"配置go-proxy跳过私服域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置go-proxy跳过私服域名"}},[s._v("#")]),s._v(" 配置Go Proxy跳过私服域名")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPRIVATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("git.dev.dra-m.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"在-gitconfig中替换url"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-gitconfig中替换url"}},[s._v("#")]),s._v(" 在.gitconfig中替换url")]),s._v(" "),t("p",[s._v("当使用go get 拉取包名时 go get，会使用git clone https://包名。")]),s._v(" "),t("p",[s._v("例如 go get dra-m.com/test，等价于 git clone https://dra-m.com/test。")]),s._v(" "),t("p",[s._v("因为我的私服仅允许ssh，且自定义端口，所以如下配置.gitconfig：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("url "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh://git@git.dev.dra-m.com:30386/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ninsteadOf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" https://git.dev.dra-m.com.com/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这意味着实际发出的命令将变成 git clone ssh://git@git.dev.dra-m.com:30386/test。")]),s._v(" "),t("p",[s._v("但gitlab中通过ssh拉取必须以.git结尾，所以要求我们的module名也以.git结尾：")]),s._v(" "),t("h4",{attrs:{id:"go-mod文件module以-git结尾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-mod文件module以-git结尾"}},[s._v("#")]),s._v(" go.mod文件module以.git结尾")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("module git"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dra"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("common"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("private"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("git\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("导入时模块名一致：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git.dev.dra-m.com/common/test-private-module.git/common"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"dockerfile-构建时包含私服包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-构建时包含私服包"}},[s._v("#")]),s._v(" DockerFile 构建时包含私服包")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" go env -w GOPRIVATE=git.dev.dra-m.com")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" git config --global  url."),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh://git@git.dev.dra-m.com:30386/"')]),s._v(".insteadof https://git.dev.dra-m.com/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./build/id_rsa.pub /root/.ssh/id_rsa.pub")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" ./build/id_rsa  /root/.ssh/id_rsa")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod -R 700 ~/.ssh/*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ssh -o "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StrictHostKeyChecking no"')]),s._v(" git@git.dev.dra-m.com -p30386")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" go mod tidy")]),s._v("\n...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);